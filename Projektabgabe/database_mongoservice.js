const MongoClient = require('mongodb').MongoClient
const assert = require('assert')
const url = 'mongodb://localhost:27017'
const client = new MongoClient(url); 
const dbName = 'Stadttour'
const collectionName = 'neueTouren'
const collection2Name = 'neueSehenswürdigkeiten'

client.connect(function(err) 
{
    assert.equal(null, err)

    console.log('Connected successfully to server')

    const db = client.db(dbName)

    //Touren Collection
    db.createCollection(collectionName, function(err, res)
    {
        if (err) throw err
        console.log("Collection created!")
    })

    const collection = db.collection(collectionName)

    const data = [
        {
            "name":"Natur-Tour",
                "type": "FeatureCollection",
                "features": [
                  {
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                      "type": "LineString",
                      "coordinates": [
                        [
                          7.618203163146972,
                          51.95611479866179
                        ],
                        [
                          7.610220909118652,
                          51.953258408047034
                        ],
                        [
                          7.605671882629394,
                          51.94995217320104
                        ],
                        [
                          7.600650787353515,
                          51.94664569458227
                        ],
                        [
                          7.598505020141602,
                          51.94355060971912
                        ],
                        [
                          7.595329284667969,
                          51.94249241205695
                        ],
                        [
                          7.594728469848633,
                          51.94278341890263
                        ],
                        [
                          7.594642639160156,
                          51.943365426930306
                        ],
                        [
                          7.596788406372069,
                          51.945984369605185
                        ],
                        [
                          7.595071792602538,
                          51.946460524571606
                        ],
                        [
                          7.5951576232910165,
                          51.94691022184277
                        ],
                        [
                          7.59601593017578,
                          51.948047671284655
                        ],
                        [
                          7.595964968204497,
                          51.948695740042716
                        ],
                        [
                          7.5968098640441895,
                          51.94894702949047
                        ],
                        [
                          7.597045898437499,
                          51.94960831078266
                        ],
                        [
                          7.596852779388428,
                          51.94984636966083
                        ],
                        [
                          7.599105834960938,
                          51.95108954549307
                        ],
                        [
                          7.601723670959472,
                          51.951909493669376
                        ],
                        [
                          7.604405879974366,
                          51.95112922075002
                        ],
                        [
                          7.605993747711181,
                          51.95292779553201
                        ],
                        [
                          7.606101036071777,
                          51.95353612067583
                        ],
                        [
                          7.60852575302124,
                          51.95439569648285
                        ],
                        [
                          7.612044811248778,
                          51.95669663370022
                        ],
                        [
                          7.614040374755859,
                          51.9578999503913
                        ],
                        [
                          7.615585327148437,
                          51.95782061182377
                        ],
                        [
                          7.615563869476318,
                          51.9586801054935
                        ],
                        [
                          7.614147663116456,
                          51.96017426295793
                        ],
                        [
                          7.614587545394897,
                          51.96029987569666
                        ],
                        [
                          7.614576816558838,
                          51.960524655508564
                        ],
                        [
                          7.614566087722778,
                          51.961860088797984
                        ],
                        [
                          7.613954544067383,
                          51.963202093063856
                        ],
                        [
                          7.612602710723877,
                          51.96310954233544
                        ],
                        [
                          7.612645626068115,
                          51.96240879490497
                        ],
                        [
                          7.612087726593017,
                          51.962303020756345
                        ],
                        [
                          7.611519098281861,
                          51.9623691296285
                        ],
                        [
                          7.610360383987426,
                          51.96232946431691
                        ],
                        [
                          7.6096200942993155,
                          51.96196586399181
                        ],
                        [
                          7.608633041381835,
                          51.961589038724526
                        ],
                        [
                          7.608300447463988,
                          51.96215758089443
                        ],
                        [
                          7.607957124710083,
                          51.96284511062979
                        ],
                        [
                          7.606165409088134,
                          51.96374417206434
                        ],
                        [
                          7.608150243759155,
                          51.96476220515285
                        ],
                        [
                          7.60899782180786,
                          51.965899201787714
                        ],
                        [
                          7.610392570495605,
                          51.96517205610167
                        ],
                        [
                          7.612795829772949,
                          51.96496052059606
                        ],
                        [
                          7.612988948822021,
                          51.9649654784709
                        ],
                        [
                          7.613081485033035,
                          51.964940689091236
                        ],
                        [
                          7.613180726766585,
                          51.9648605366698
                        ],
                        [
                          7.613697052001954,
                          51.964973741594434
                        ],
                        [
                          7.613900899887086,
                          51.965628176138345
                        ],
                        [
                          7.615574598312377,
                          51.9655554616609
                        ],
                        [
                          7.615617513656615,
                          51.96548935748814
                        ],
                        [
                          7.615875005722047,
                          51.96531748618265
                        ],
                        [
                          7.616271972656249,
                          51.96530426528567
                        ],
                        [
                          7.6165616512298575,
                          51.966573453609904
                        ],
                        [
                          7.617301940917968,
                          51.96702294918948
                        ],
                        [
                          7.620391845703124,
                          51.96715515291374
                        ],
                        [
                          7.623267173767089,
                          51.96679820196322
                        ],
                        [
                          7.630029022693634,
                          51.96789383404603
                        ],
                        [
                          7.630908787250518,
                          51.96795993467242
                        ],
                        [
                          7.631933391094207,
                          51.96771536186778
                        ],
                        [
                          7.633824348449706,
                          51.965899201787714
                        ],
                        [
                          7.634122073650359,
                          51.964154032322156
                        ],
                        [
                          7.634403705596923,
                          51.96090148972336
                        ],
                        [
                          7.629854679107666,
                          51.957397470425725
                        ],
                        [
                          7.627902030944824,
                          51.95653795216583
                        ],
                        [
                          7.626378536224365,
                          51.9565247286793
                        ],
                        [
                          7.622451782226563,
                          51.95727846118796
                        ],
                        [
                          7.621464729309083,
                          51.956881761447164
                        ],
                        [
                          7.6207780838012695,
                          51.956881761447164
                        ],
                        [
                          7.620413303375244,
                          51.95702721842635
                        ],
                        [
                          7.619855403900146,
                          51.957080111756326
                        ],
                        [
                          7.619404792785644,
                          51.957159451634276
                        ],
                        [
                          7.618975639343262,
                          51.95636604653648
                        ],
                        [
                          7.618288993835448,
                          51.956141245872814
                        ]
                      ]
                    }
                  }
                ]
              },

      {
        "name": "Klassiker-Tour",
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "properties": {},
            "geometry": {
              "type": "LineString",
              "coordinates": [
                [
                  7.618138790130615,
                  51.956961101676114
                ],
                [
                  7.618310451507568,
                  51.95734457747017
                ],
                [
                  7.615928649902344,
                  51.957542925731765
                ],
                [
                  7.616572380065919,
                  51.95809829619583
                ],
                [
                  7.616057395935059,
                  51.95910323478566
                ],
                [
                  7.61502742767334,
                  51.96008170597784
                ],
                [
                  7.614641189575196,
                  51.96124526554213
                ],
                [
                  7.6146841049194345,
                  51.96201214056061
                ],
                [
                  7.613997459411621,
                  51.96293766190423
                ],
                [
                  7.613697052001954,
                  51.96378383612403
                ],
                [
                  7.617945671081543,
                  51.963492965537746
                ],
                [
                  7.620520591735841,
                  51.96351940839632
                ],
                [
                  7.621808052062988,
                  51.96399537718307
                ],
                [
                  7.623267173767089,
                  51.96384994281223
                ],
                [
                  7.6233530044555655,
                  51.963717729338356
                ],
                [
                  7.624490261077881,
                  51.96406148355925
                ],
                [
                  7.624983787536621,
                  51.96416725355839
                ],
                [
                  7.626357078552247,
                  51.96408792608244
                ],
                [
                  7.627601623535156,
                  51.96375078274338
                ],
                [
                  7.628298997879028,
                  51.96306326689955
                ],
                [
                  7.6283955574035645,
                  51.962613731607675
                ],
                [
                  7.627902030944824,
                  51.961727869454705
                ],
                [
                  7.625927925109863,
                  51.962078249861754
                ],
                [
                  7.625799179077148,
                  51.963010380628624
                ],
                [
                  7.625799179077148,
                  51.962065028009334
                ],
                [
                  7.628052234649658,
                  51.961509706685675
                ],
                [
                  7.628588676452637,
                  51.96260712076093
                ],
                [
                  7.630155086517334,
                  51.962197246358116
                ],
                [
                  7.631657123565673,
                  51.96144359654604
                ],
                [
                  7.632343769073485,
                  51.96119237712624
                ],
                [
                  7.632944583892822,
                  51.96050482204108
                ],
                [
                  7.633481025695801,
                  51.96026681974691
                ],
                [
                  7.634146213531494,
                  51.959579250465694
                ],
                [
                  7.635025978088378,
                  51.95976436630958
                ],
                [
                  7.638330459594727,
                  51.958415647657844
                ],
                [
                  7.637429237365723,
                  51.955929667747924
                ],
                [
                  7.635927200317382,
                  51.951644995895805
                ],
                [
                  7.637214660644531,
                  51.95058698920022
                ],
                [
                  7.638673782348632,
                  51.951539196349536
                ]
              ]
            }
          }
        ]
      },

      {
        "name": "Kulinarische-Tour",
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "properties": {},
            "geometry": {
              "type": "LineString",
              "coordinates": [
                [
                  7.614351511001586,
                  51.96711218674612
                ],
                [
                  7.6143890619277945,
                  51.967251000369984
                ],
                [
                  7.615075707435608,
                  51.96729727148237
                ],
                [
                  7.6153600215911865,
                  51.96712871220007
                ],
                [
                  7.615118622779846,
                  51.966930406350436
                ],
                [
                  7.615376114845275,
                  51.96710557656284
                ],
                [
                  7.617065906524659,
                  51.9663619247184
                ],
                [
                  7.617865204811096,
                  51.96315581772354
                ],
                [
                  7.61802613735199,
                  51.96318226078099
                ],
                [
                  7.6180315017700195,
                  51.96308971001161
                ],
                [
                  7.619748115539551,
                  51.9626666183466
                ],
                [
                  7.619898319244384,
                  51.96260381533719
                ],
                [
                  7.619844675064087,
                  51.962415405781
                ],
                [
                  7.622580528259277,
                  51.961813812072194
                ],
                [
                  7.622323036193847,
                  51.96139731939029
                ],
                [
                  7.622623443603516,
                  51.96100065609549
                ],
                [
                  7.623031139373779,
                  51.96096760066249
                ],
                [
                  7.624146938323975,
                  51.96059737814756
                ],
                [
                  7.626013755798339,
                  51.96065026726547
                ],
                [
                  7.626206874847412,
                  51.95989659144437
                ],
                [
                  7.625927925109863,
                  51.95914290295206
                ],
                [
                  7.625799179077148,
                  51.95894456176911
                ],
                [
                  7.626593112945556,
                  51.957212344808255
                ],
                [
                  7.6266346871852875,
                  51.95706606197163
                ],
                [
                  7.626835852861404,
                  51.95711564942735
                ],
                [
                  7.626772820949554,
                  51.957215650629564
                ],
                [
                  7.627580165863036,
                  51.95768838056588
                ],
                [
                  7.6284921169281,
                  51.95776110780599
                ],
                [
                  7.629264593124389,
                  51.95767515741864
                ],
                [
                  7.630337476730346,
                  51.95851481952902
                ],
                [
                  7.6329874992370605,
                  51.960491599724556
                ],
                [
                  7.633395195007324,
                  51.96028004212974
                ],
                [
                  7.634167671203614,
                  51.95965858592096
                ],
                [
                  7.63498306274414,
                  51.959314797934134
                ],
                [
                  7.6361095905303955,
                  51.95931645076731
                ],
                [
                  7.63785570859909,
                  51.95865200692253
                ],
                [
                  7.637804746627808,
                  51.95844705210745
                ],
                [
                  7.637895941734313,
                  51.958666882638774
                ],
                [
                  7.634854316711425,
                  51.959817256410304
                ],
                [
                  7.634221315383911,
                  51.95971808742027
                ],
                [
                  7.633534669876098,
                  51.96028004212974
                ],
                [
                  7.6330411434173575,
                  51.960577544712265
                ],
                [
                  7.633641958236694,
                  51.961205599236074
                ],
                [
                  7.6337385177612305,
                  51.96203197336119
                ],
                [
                  7.633124291896819,
                  51.961722911221756
                ],
                [
                  7.633164525032043,
                  51.9616105244609
                ],
                [
                  7.633084058761596,
                  51.96169977279403
                ],
                [
                  7.633684873580933,
                  51.962104693554906
                ],
                [
                  7.631903886795043,
                  51.96291782950434
                ],
                [
                  7.631207853555679,
                  51.96370946598328
                ],
                [
                  7.631005346775055,
                  51.963833416149335
                ],
                [
                  7.630450129508972,
                  51.96402181974524
                ],
                [
                  7.630020976066589,
                  51.9641441163924
                ],
                [
                  7.630257010459899,
                  51.96433582397861
                ],
                [
                  7.630487680435181,
                  51.96435235045627
                ],
                [
                  7.630262374877931,
                  51.964378792807864
                ],
                [
                  7.629935145378113,
                  51.96415072701248
                ],
                [
                  7.628545761108398,
                  51.96465643655768
                ],
                [
                  7.627108097076416,
                  51.96528112870663
                ],
                [
                  7.6245760917663565,
                  51.965661228134564
                ],
                [
                  7.623095512390136,
                  51.96621649802639
                ],
                [
                  7.621722221374512,
                  51.965608344928924
                ],
                [
                  7.621614933013915,
                  51.965876065515765
                ],
                [
                  7.621679306030273,
                  51.96590911732917
                ],
                [
                  7.621582746505736,
                  51.96588928624405
                ],
                [
                  7.621899247169495,
                  51.96522493982207
                ],
                [
                  7.621185779571533,
                  51.965254686887384
                ],
                [
                  7.621293067932128,
                  51.96513239327041
                ]
              ]
            }
          }
        ]
      },

      {
        "name": "Spritwoch-Tour",
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "properties": {},
            "geometry": {
              "type": "LineString",
              "coordinates": [
                [
                  7.620992660522461,
                  51.96527121302625
                ],
                [
                  7.620627880096435,
                  51.96579343587563
                ],
                [
                  7.619190216064452,
                  51.9655554616609
                ],
                [
                  7.617945671081543,
                  51.96656023308342
                ],
                [
                  7.619211673736572,
                  51.96673209962335
                ],
                [
                  7.620177268981933,
                  51.96669243817262
                ],
                [
                  7.621293067932128,
                  51.96661311516589
                ],
                [
                  7.621872425079345,
                  51.965185277037605
                ],
                [
                  7.622693181037902,
                  51.96507785682013
                ],
                [
                  7.623540759086609,
                  51.96442176159591
                ],
                [
                  7.6253485679626465,
                  51.964097842024614
                ],
                [
                  7.626442909240723,
                  51.964081315453114
                ],
                [
                  7.62749433517456,
                  51.96378879412902
                ],
                [
                  7.627915441989898,
                  51.963587168150184
                ],
                [
                  7.628341913223267,
                  51.96302360220222
                ],
                [
                  7.628406286239623,
                  51.96265339666774
                ],
                [
                  7.629661560058594,
                  51.96232285342823
                ],
                [
                  7.630198001861572,
                  51.96213113723247
                ],
                [
                  7.631099224090576,
                  51.96173448043114
                ],
                [
                  7.631657123565673,
                  51.961470040613605
                ],
                [
                  7.633263766765595,
                  51.96035441796046
                ],
                [
                  7.6335400342941275,
                  51.96021558297662
                ],
                [
                  7.634173035621643,
                  51.959656933100405
                ],
                [
                  7.634521722793578,
                  51.9597610606762
                ],
                [
                  7.634985744953155,
                  51.95974949095752
                ],
                [
                  7.635583877563477,
                  51.95952966573485
                ],
                [
                  7.635857462882996,
                  51.95957759764224
                ],
                [
                  7.635776996612549,
                  51.959447024394905
                ],
                [
                  7.638330459594727,
                  51.958442093511614
                ],
                [
                  7.637300491333008,
                  51.95574453606963
                ],
                [
                  7.63597011566162,
                  51.9515656462595
                ],
                [
                  7.64000415802002,
                  51.94870896583823
                ],
                [
                  7.640261650085449,
                  51.94829235140597
                ],
                [
                  7.639682292938232,
                  51.948417997435996
                ],
                [
                  7.638802528381347,
                  51.947650889871994
                ],
                [
                  7.638609409332275,
                  51.945058498255136
                ]
              ]
            }
          }
        ]
      }
    ]

    insertDocuments(db, collection, data, function()
    {
      console.log("Insertion operation done")
      //client.close()
    })

    countRows(collection)

    findDocuments(db, collection, function () {
      console.log("Closing the client...")
      client.close()
    })

    // Sehenswürdigkeiten Collection
    db.createCollection(collection2Name, function(err, res)
    {
        if (err) throw err
        console.log("Collection created!")
    })

    const collection2 = db.collection(collection2Name)

    const data2 = [
      {
        "name": "Schloss Münster",
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "properties": {},
            "geometry": {
              "type": "Point",
              "coordinates": [
                7.613243758678437,
                51.96361030560367
              ]
            }
          }
        ]
      }
    ]

    insertDocuments(db, collection2, data2, function()
    {
      console.log("Insertion operation done")
      //client.close()
    })

    countRows(collection2)

    findDocuments(db, collection2, function () {
      console.log("Closing the client...")
      client.close()
    })
})

const insertDocuments = function(db, collection, data, callback) 
{
    // Insert some documents
    collection.insertMany(data, function(err, result) 
    {
      assert.equal(err, null)
      assert.equal(1, result.result.ok)
      //console.log(result)
      console.log(`Inserted ${result.insertedCount} documents into the collection`)
      callback(result)
    })
} 

const findDocuments = function (db, collection, callback) {
  collection.find({}).toArray(function(err, docs)
  {
    assert.equal(err,null);
    console.log('Found the following routes');
    console.log(docs);
    callback(docs)
  })
}

const countRows = function(collection)
{
  collection.count(function (err, count) 
  {
    if(err) throw err
    console.log('Total Rows: ' + count)
  })
}